***********
Security
***********

Similar to medieval fortifications it is recommended to provide your servers with multiple layers of defenses. Be sure to use Firewalls, Strong passwords, SSH, and make sure your servers are kept up to date for all software being used. This inlcudes the operating system, FreeSWITCH and FusionPBX.


FusionPBX
^^^^^^^^
The latest Debian install script configures IPTables firewall for you. FusionPBX extensions set strong passwords for you by default. You can increase the password complexity using settings in Advanced -> Default Settings to increase the length of the passwords that are generated by default.


Firewall
^^^^^^^^
Although the new install script configured IPTables for you it is recommended that you review the settings. On Debian and Ubuntu you can check your firewall with the following command.

::

 iptables -L

SSL / TLS
^^^^^^^^^^

SSL and TLS are very necessary in today's internet applications from VOIP to Websites.  There are expensive services you can purchase for SSL certificates and free options.  We'll cover one of the free options.

Let's Encrypt
==============

Let's Encrypt is one of the most recent and widely used form of free SSL security.  You can use Let's Encrypt with your FusionPBX install and WebRTC like Verto Communicator.

More info on NGINX with Let's Encrypt
https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx

**Clone Let's Encrypt**

::

 cd /usr/src/
 git clone https://github.com/letsencrypt/letsencrypt /opt/letsencrypt

**Execute certbot-auto**

::

 chmod a+x ./certbot-auto
 ./certbot-auto
 cd /etc/letsencrypt/
 mkdir -p configs
 cd configs
 
**Copy code example from `link`_ in step #2 section and edit domains, key size, email then put into: /etc/letsencrypt/configs/domain.tld.conf**

::

 touch /etc/letsencrypt/configs/domain.tld.conf
 Vim  /etc/nginx/sites-available/fusionpbx
 Add this after the ssl_ciphers line
 
 location /.well-known/acme-challenge {
         root /var/www/letsencrypt;
     }
     
 Reload and check Nginx
 nginx -t && nginx -s reload
 Should output:
 nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
 nginx: configuration file /etc/nginx/nginx.conf test is successful

**Execute Let's Encrypt script**  (Edit domain.tld to reflect your domain)

::

 cd /opt/letsencrypt
 ./letsencrypt-auto --config /etc/letsencrypt/configs/domain.tld.conf certonly
 Should output:
 - Congratulations! And a paragraph about the keys made and where the live.


**Edit sites-available**  (Edit domain.tld to reflect your domain)

::

 Comment out and add
 Vim  /etc/nginx/sites-available/fusionpbx
        #ssl_certificate         /etc/ssl/certs/nginx.crt;
        #ssl_certificate_key     /etc/ssl/private/nginx.key;
        ssl_certificate /etc/letsencrypt/live/domain.tld/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/domain.tld/privkey.pem;

**Auto Renew certificate**

::

 cd /etc/fusionpbx/
 touch renew-letsencrypt.sh
 Put code example from Automating Renewal section step#1 into renew-letsencrypt.sh
 Edit the my-domain.conf with the domain name you made a few steps earlier
 Create crontab -e
 0 0 1 JAN,MAR,MAY,JUL,SEP,NOV * /path/to/renew-letsencrypt.sh
 This runs every two months


Upgrade
^^^^^^^^

Security problems are fixed as they are discovered and are updated for master and the latest release. Upgrades are considered an important part of keeping the server secure. `Upgrades`_ always need to be done on the operating system, FreeSWITCH and FusionPBX. On Debian and Ubuntu you can check your firewall with the following command.

Latest install script will install FreeSWITCH packages by default to upgrade them and operating system packages run the following commands.

::

 apt-get update
 apt-get upgrade


If you need help upgrading safely please consider `paid support`_.


XML RPC
^^^^^^^^

New install mod_xml_rpc is not enabled by default. It is recommended to run a firewall on all FusionPBX servers. The latest debian install script configures the firewall by default. However it is recommended to check to make sure it is installed and running.

Mod_xml_rpc allows running remote commands to FreeSWITCH. Ensure you have afirewall that is protecting the XML RPC port. Consider changing the XML RPC password. At very least do not allow access to the public. Advanced -> Settings page in the interface allows you to change the password or the port. Do not allow public access to the XML RPC port.

Latest Debian install script installs `iptables`_ firewall which prevents public access to the mod_xml_rpc port. If you are not using a firewall on the server you should even if its protected by by an external firewall. Some not informed co-worker could expose the server to the public internet at some point in the future. Multiple layers of security is considered best practice.


Fail2ban
^^^^^^^^

Fail2ban is also used to protect SSH, FreeSWITCH, the web server as well as other services. 
You can view the IP addresses blocked by Fail2ban with the following command.

::

 iptables -L


SSH
^^^^^^^^

Use strong passwords with SSH or even better use SSH keys for better protection of your servers.



.. _Upgrade: /en/latest/getting_started/advanced/upgrade.html
.. _Upgrades: /en/latest/getting_started/advanced/upgrade.html
.. _link: https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx
.. _paid support: http://www.fusionpbx.com
.. _firewall: /en/latest/getting_started/iptables.html#iptables
.. _iptables: /en/latest/getting_started/iptables.html#iptables
